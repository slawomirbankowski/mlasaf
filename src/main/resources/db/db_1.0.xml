<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">


    <changeSet id="1" author="slawomirbankowski">

        <createSequence cycle="false" incrementBy="1" minValue="10" sequenceName="seq_id" startValue="10"/>

        <createTable tableName="executorhost" remarks="host on which executor can execute" >
            <column name="executorhostid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="insertedrowdate" type="timestamp"/>
            <column name="hostname" type="varchar(4000)"/>
            <column name="hostip" type="varchar(4000)"/>
            <column name="hostdomain" type="varchar(4000)"/>
            <column name="hostostype" type="varchar(4000)"/>
            <column name="hostosversion" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="executortype">
            <column name="executortypeid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executortypename" type="varchar(4000)"/>
            <column name="executortypeclass" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="executorrest">
            <column name="executorrestid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executorhostid" type="bigint"/>
            <column name="restport" type="int"/>
            <column name="restversion" type="varchar(4000)"/>
            <column name="reststatus" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="executorrestcall">
            <column name="executorrestcallid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executorhostid" type="bigint"/>
            <column name="executorrestid" type="bigint"/>
            <column name="requestmethod" type="varchar(4000)"/>
            <column name="requestheader" type="varchar(4000)"/>
            <column name="requestbody" type="varchar(4000)"/>
            <column name="responsebody" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="executorinstance">
            <column name="executorinstanceid" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executortypeid" type="bigint"/>
            <column name="executorhostid" type="bigint"/>
            <column name="executorinstancename" type="varchar(4000)"/>
            <column name="isrunning" type="int"/>
            <column name="isfinished" type="int"/>
            <column name="portnumber" type="int"/>
            <column name="insertedrowdate" type="timestamp"/>
            <column name="guid" type="bigint"/>
            <column name="enddate" type="timestamp"/>
        </createTable>

        <createTable tableName="executorstoragetype">
            <column name="executorstoragetypeid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executorstoragetypename" type="varchar(4000)"/>
            <column name="executorstoragetypeclass" type="varchar(4000)"/>
        </createTable>
        <insert tableName="executorstoragetype">
            <column name="executorstoragetypeid" value="1"/>
            <column name="executorstoragetypename" value="local_disk"/>
            <column name="executorstoragetypeclass" value="com.mlasaf.storage.localdiskstorage"/>
        </insert>
        <insert tableName="executorstoragetype">
            <column name="executorstoragetypeid" value="2"/>
            <column name="executorstoragetypename" value="hdfs"/>
            <column name="executorstoragetypeclass" value="com.mlasaf.storage.hdfsstorage"/>
        </insert>
        <insert tableName="executorstoragetype">
            <column name="executorstoragetypeid" value="3"/>
            <column name="executorstoragetypename" value="db"/>
            <column name="executorstoragetypeclass" value="com.mlasaf.storage.dbstorage"/>
        </insert>

        <createTable tableName="executorstorage" remarks="storage assigned to executor" >
            <column name="executorstorageid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executorhostid" type="bigint"/>
            <column name="executorstoragetypeid" type="bigint"/>
            <column name="storagedefinition" type="varchar(4000)"/>
            <column name="storagebasepath" type="varchar(4000)"/>
            <column name="storagefulllpath" type="varchar(4000)"/>
            <column name="isrunning" type="int"/>
            <column name="portnumber" type="int"/>
            <column name="insertedrowdate" type="timestamp"/>
            <column name="guid" type="bigint"/>
        </createTable>
        <createIndex indexName="idx_es_executorstorageid" tableName="executorstorage" unique="false">
            <column name="executorstorageid" />
        </createIndex>
        <createIndex indexName="idx_es_executorstoragetypeid" tableName="executorstorage" unique="false">
            <column name="executorstoragetypeid" />
        </createIndex>

        <createTable tableName="executorstorageview" remarks="storage assigned to executor" >
            <column name="executorstorageviewid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executorstorageid" type="bigint"/>
            <column name="sourcedownloadid" type="bigint"/>
            <column name="storagepath" type="varchar(4000)"/>
            <column name="viewsize" type="bigint"/>
            <column name="viewrowscount" type="bigint"/>
        </createTable>

        <createTable tableName="resourcemanagertype">
            <column name="resourcemanagertypeid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="resourcemanagertypename" type="varchar(4000)"/>
            <column name="resourcemanagertypeclass" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="resourcemanager">
            <column name="resourcemanagerid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="resourcemanagertypeid" type="bigint"/>
            <column name="executorhostid" type="bigint"/>
            <column name="resourcemanagerstatus" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="resourcemanagermeasure">
            <column name="resourcemanagermeasureid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="resourcemanagerid" type="bigint"/>
            <column name="measurestring" type="varchar(4000)"/>
            <column name="measurevalue" type="float"/>
        </createTable>

        <createTable tableName="resourcemanagercheck">
            <column name="resourcemanagercheckid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="executorhostid" type="bigint"/>
            <column name="resourcemanagerstatus" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="resourcemanagerallocation">
            <column name="resourcemanagerallocationid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="resourcemanagertypeid" type="bigint"/>
            <column name="executorhostid" type="bigint"/>
            <column name="resourcemanagerstatus" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="sourcetype" remarks="type of source: jdbc, ftp, shared folder" >
            <column name="sourcetypeid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourcetypename" type="varchar(4000)"/>
            <column name="sourcetypeclass" type="varchar(4000)"/>
        </createTable>
        <createIndex indexName="idx_sourcetype_sourcetypename" tableName="sourcetype" unique="false">
            <column name="sourcetypename" />
        </createIndex>
        <insert tableName="sourcetype">
            <column name="sourcetypeid" value="1"/>
            <column name="sourcetypename" value="jdbc"/>
            <column name="sourcetypeclass" value="com.mlasaf.sources.jdbcsource"/>
        </insert>
        <insert tableName="sourcetype">
            <column name="sourcetypeid" value="2"/>
            <column name="sourcetypename" value="ftp"/>
            <column name="sourcetypeclass" value="com.mlasaf.sources.ftpsource"/>
        </insert>
        <insert tableName="sourcetype">
            <column name="sourcetypeid" value="3"/>
            <column name="sourcetypename" value="local"/>
            <column name="sourcetypeclass" value="com.mlasaf.sources.localdisksource"/>
        </insert>

        <createTable tableName="sourceinstance" remarks="a string" >
            <column name="sourceinstanceid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourcetypeid" type="bigint"/>
            <column name="sourceinstancename" type="varchar(4000)"/>
            <column name="errorcount" type="bigint"/>
            <column name="correctcount" type="bigint"/>
            <column name="laststatus" type="varchar(4000)"/>
            <column name="lastconnectiondate" type="timestamp"/>
        </createTable>
        <createIndex indexName="idx_si_sourcetypeid" tableName="sourceinstance" unique="false">
            <column name="sourcetypeid" />
        </createIndex>
        <createIndex indexName="idx_si_sourceinstancename" tableName="sourceinstance" unique="false">
            <column name="sourceinstancename" />
        </createIndex>

        <createTable tableName="sourceparam" remarks="dictionary - all parameters needed to define source instance" >
            <column name="sourceparamid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourceparamname" type="varchar(4000)"/>
            <column name="sourceparamtype" type="varchar(4000)"/>
            <column name="possiblevalues" type="varchar(4000)"/>
        </createTable>
        <insert tableName="sourceparam">
            <column name="sourceparamid" value="1"/>
            <column name="sourceparamname" value="connection string"/>
            <column name="sourceparamtype" value="string"/>
            <column name="possiblevalues" value="jdbc:sqlserver://host:port/dbname|jdbc:mysql://host:port/dbname"/>
        </insert>
        <insert tableName="sourceparam">
            <column name="sourceparamid" value="2"/>
            <column name="sourceparamname" value="user"/>
            <column name="sourceparamtype" value="string"/>
            <column name="possiblevalues" value=""/>
        </insert>
        <insert tableName="sourceparam">
            <column name="sourceparamid" value="3"/>
            <column name="sourceparamname" value="password"/>
            <column name="sourceparamtype" value="string"/>
            <column name="possiblevalues" value=""/>
        </insert>
        <insert tableName="sourceparam">
            <column name="sourceparamid" value="4"/>
            <column name="sourceparamname" value="driver class"/>
            <column name="sourceparamtype" value="string"/>
            <column name="possiblevalues" value=""/>
        </insert>
        <insert tableName="sourceparam">
            <column name="sourceparamid" value="5"/>
            <column name="sourceparamname" value="ftp host"/>
            <column name="sourceparamtype" value="string"/>
            <column name="possiblevalues" value=""/>
        </insert>
        <insert tableName="sourceparam">
            <column name="sourceparamid" value="6"/>
            <column name="sourceparamname" value="ftp port"/>
            <column name="sourceparamtype" value="int"/>
            <column name="possiblevalues" value=""/>
        </insert>

        <createTable tableName="sourcetypeparam" remarks="dictionary - mapping between source type like ftp or jdbc and parameters" >
            <column name="sourcetypeid" type="bigint" />
            <column name="sourceparamid" type="bigint"/>
            <column name="isrequired" type="int"/>
        </createTable>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="1"/>
            <column name="sourceparamid" value="1"/>
            <column name="isrequired" value="1"/>
        </insert>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="1"/>
            <column name="sourceparamid" value="2"/>
            <column name="isrequired" value="1"/>
        </insert>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="1"/>
            <column name="sourceparamid" value="3"/>
            <column name="isrequired" value="1"/>
        </insert>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="1"/>
            <column name="sourceparamid" value="4"/>
            <column name="isrequired" value="0"/>
        </insert>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="2"/>
            <column name="sourceparamid" value="5"/>
            <column name="isrequired" value="1"/>
        </insert>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="2"/>
            <column name="sourceparamid" value="6"/>
            <column name="isrequired" value="1"/>
        </insert>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="2"/>
            <column name="sourceparamid" value="2"/>
            <column name="isrequired" value="1"/>
        </insert>
        <insert tableName="sourcetypeparam">
            <column name="sourcetypeid" value="2"/>
            <column name="sourceparamid" value="3"/>
            <column name="isrequired" value="1"/>
        </insert>

        <createTable tableName="sourceparamvalue" remarks="value of param for given source instance" >
            <column name="sourceinstanceid" type="bigint" />
            <column name="sourceparamid" type="bigint"/>
            <column name="sourceparamvalueid" type="bigint"/>
            <column name="sourceparamvalueversion" type="varchar(4000)"/>
            <column name="insertedrowdate" type="timestamp"/>
            <column name="paramvalue" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="sourceviewtype" remarks="type of view: ftp, file in ftp, table or view in database, method in webservice" >
            <column name="sourceviewtypeid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourceviewtypename" type="varchar(4000)"/>
            <column name="sourceviewtypeclass" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="sourceview" remarks="view in the source - could be folder in ftp, file in ftp, table or view in database, method in webservice" >
            <column name="sourceviewid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourceinstanceid" type="bigint"/>
            <column name="sourceviewtypeid" type="bigint"/>
            <column name="sourceviewdefinition" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="sourceviewcolumn" remarks="column in the view - update/refresh while downloading source to storage" >
            <column name="sourceviewcolumnid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourceviewid" type="bigint" />
            <column name="insertedrowdate" type="timestamp"/>
            <column name="guid" type="varchar(4000)"/>
            <column name="columnname" type="varchar(4000)"/>
            <column name="columnminvalue" type="varchar(4000)"/>
            <column name="columnmaxvalue" type="varchar(4000)"/>
            <column name="columnnonemptycount" type="bigint"/>
        </createTable>

        <createTable tableName="sourceschedule" remarks="schedule to download source view to local storage" >
            <column name="sourcescheduleid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourceviewid" type="bigint"/>
            <column name="executorstorageid" type="bigint"/>
            <column name="insertedrowdate" type="timestamp"/>
            <column name="guid" type="bigint"/>
            <column name="ondemand" type="int" defaultValueNumeric="0"/>
            <column name="starttime" type="timestamp"/>
            <column name="intervalvalue" type="bigint"/>
        </createTable>

        <createTable tableName="sourcedownload" remarks="run of source and download data to local/global storage - this is process only" >
            <column name="sourcedownloadid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sourcescheduleid" type="bigint" />
            <column name="insertedrowdate" type="timestamp"/>
            <column name="lastupdateddate" type="timestamp"/>
            <column name="retrynumber" type="int"/>
            <column name="isrunning" type="int" defaultValueNumeric="0" />
            <column name="isfinished" type="int" defaultValueNumeric="0" />
            <column name="isexcecption" type="int" defaultValueNumeric="0" />
            <column name="excecptiondescription" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="algorithmtype" remarks="algorithm connected with reason to build it, general class with input columns and output columns for results" >
            <column name="algorithmtypeid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmtypename" type="varchar(4000)"/>
            <column name="algorithmtypedescription" type="varchar(4000)"/>
            <column name="insertedrowdate" type="timestamp"/>
        </createTable>
        <insert tableName="algorithmtype">
            <column name="algorithmtypeid" value="1"/>
            <column name="algorithmtypename" value="prediction"/>
        </insert>
        <insert tableName="algorithmtype">
            <column name="algorithmtypeid" value="2"/>
            <column name="algorithmtypename" value="classification"/>
        </insert>
        <insert tableName="algorithmtype">
            <column name="algorithmtypeid" value="3"/>
            <column name="algorithmtypename" value="market basket"/>
        </insert>
        <insert tableName="algorithmtype">
            <column name="algorithmtypeid" value="4"/>
            <column name="algorithmtypename" value="outlier detection"/>
        </insert>
        <insert tableName="algorithmtype">
            <column name="algorithmtypeid" value="5"/>
            <column name="algorithmtypename" value="sentiment"/>
        </insert>

        <createTable tableName="algorithmtypeversion" remarks="version of algorithm" >
            <column name="algorithmtypeversionid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmtypeid" type="bigint"/>
            <column name="algorithmtypeversionname" type="varchar(4000)"/>
            <column name="insertedrowdate" type="timestamp"/>
        </createTable>

        <createTable tableName="algorithmimplementation" remarks="dictionary - implementation of algorithm version for given type of executor" >
            <column name="algorithmimplementationid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmtypeid" type="bigint"/>
            <column name="algorithmtypeversionid" type="bigint"/>
            <column name="executortypeid" type="bigint"/>
            <column name="algorithmimplementationname" type="varchar(4000)"/>
            <column name="algorithmimplementationclass" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="algorithmparam" remarks="dictionary - parameter needed to run algorithm " >
            <column name="algorithmparamid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmparamname" type="varchar(4000)"/>
            <column name="algorithmparamtype" type="varchar(4000)"/>
        </createTable>
        <insert tableName="algorithmparam">
            <column name="algorithmparamid" value="1"/>
            <column name="algorithmparamname" value="prediction times"/>
            <column name="algorithmparamtype" value="double"/>
        </insert>

        <createTable tableName="algorithmparamtype" remarks="dictionary - parameter needed to run algorithm " >
            <column name="algorithmparamid" type="bigint" />
            <column name="algorithmtypeid" type="bigint" />
        </createTable>

        <createTable tableName="algorithmcolumntype" remarks="dictionary - type of column to be used for ml algorithm" >
            <column name="algorithmcolumntypeid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmcolumntypename" type="varchar(4000)"/>
            <column name="algorithmcolumntypedescription" type="varchar(4000)"/>
        </createTable>
        <insert tableName="algorithmcolumntype">
            <column name="algorithmcolumntypeid" value="1"/>
            <column name="algorithmcolumntypename" value="group"/>
            <column name="algorithmcolumntypedescription" value=""/>
        </insert>
        <insert tableName="algorithmcolumntype">
            <column name="algorithmcolumntypeid" value="2"/>
            <column name="algorithmcolumntypename" value="time"/>
            <column name="algorithmcolumntypedescription" value=""/>
        </insert>
        <insert tableName="algorithmcolumntype">
            <column name="algorithmcolumntypeid" value="3"/>
            <column name="algorithmcolumntypename" value="predictionvalue"/>
            <column name="algorithmcolumntypedescription" value=""/>
        </insert>
        <insert tableName="algorithmcolumntype">
            <column name="algorithmcolumntypeid" value="4"/>
            <column name="algorithmcolumntypename" value="feature"/>
            <column name="algorithmcolumntypedescription" value=""/>
        </insert>
        <insert tableName="algorithmcolumntype">
            <column name="algorithmcolumntypeid" value="5"/>
            <column name="algorithmcolumntypename" value="label"/>
            <column name="algorithmcolumntypedescription" value=""/>
        </insert>

        <createTable tableName="algorithmtypecolumntype" remarks="dictionary - mapping between algorithm type like prediction or classification and column type to be mapped from downloaded data" >
            <column name="algorithmtypeid" type="bigint" />
            <column name="algorithmcolumntypeid" type="bigint"/>
            <column name="allowmultiple" type="int"/>
            <column name="allowempty" type="int"/>
        </createTable>
        <insert tableName="algorithmtypecolumntype">
            <column name="algorithmtypeid" value="1"/>
            <column name="algorithmcolumntypeid" value="2"/>
            <column name="allowmultiple" value="0"/>
        </insert>
        <insert tableName="algorithmtypecolumntype">
            <column name="algorithmtypeid" value="1"/>
            <column name="algorithmcolumntypeid" value="1"/>
            <column name="allowmultiple" value="1"/>
        </insert>
        <insert tableName="algorithmtypecolumntype">
            <column name="algorithmtypeid" value="1"/>
            <column name="algorithmcolumntypeid" value="3"/>
            <column name="allowmultiple" value="0"/>
        </insert>

        <createTable tableName="algorithmschedule" remarks="schedule of run algorithm for given instance and parameters on given executor" >
            <column name="algorithmscheduleid" type="bigint" autoIncrement="false">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmimplementationid" type="bigint"/>
            <column name="algorithmschedulename" type="varchar(4000)"/>
            <column name="isscheduled" type="int"/>
            <column name="insertedrowdate" type="timestamp"/>
        </createTable>

        <createTable tableName="algorithmscheduleviewtype" remarks="dictionary - type of view for schedule - primary, training, testing, validation" >
            <column name="algorithmscheduleviewtypeid" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmscheduleviewtypename" type="varchar(4000)"/>
        </createTable>
        <insert tableName="algorithmscheduleviewtype">
            <column name="algorithmscheduleviewtypeid" value="1"/>
            <column name="algorithmscheduleviewtypename" value="primary"/>
        </insert>
        <insert tableName="algorithmscheduleviewtype">
            <column name="algorithmscheduleviewtypeid" value="2"/>
            <column name="algorithmscheduleviewtypename" value="training"/>
        </insert>
        <insert tableName="algorithmscheduleviewtype">
            <column name="algorithmscheduleviewtypeid" value="3"/>
            <column name="algorithmscheduleviewtypename" value="testing"/>
        </insert>
        <insert tableName="algorithmscheduleviewtype">
            <column name="algorithmscheduleviewtypeid" value="4"/>
            <column name="algorithmscheduleviewtypename" value="validation"/>
        </insert>

        <createTable tableName="algorithmscheduleview" remarks="connection between schedule of algorithm run and source view to be used" >
            <column name="algorithmscheduleviewid" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmscheduleviewtypeid" type="bigint"/>
            <column name="sourceviewid" type="bigint"/>
            <column name="insertedrowdate" type="timestamp"/>
            <column name="joinondefinition" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="algorithmscheduleparam" remarks="" >
            <column name="algorithmscheduleid" type="bigint"/>
            <column name="algorithmparamid" type="bigint"/>
            <column name="algorithmparamvalue" type="varchar(4000)"/>
            <column name="insertedrowdate" type="timestamp"/>
        </createTable>

        <createTable tableName="algorithmschedulecolumn" remarks="view column downloaded from source mapped for schedule to algorithm input column" >
            <column name="algorithmscheduleid" type="bigint"/>
            <column name="algorithmcolumntypeid" type="bigint"/>
            <column name="algorithmscheduleviewid" type="bigint"/>
            <column name="sourceviewid" type="bigint"/>
            <column name="sourceviewcolumnid" type="bigint"/>
            <column name="extendedproperties" type="varchar(4000)"/>
            <column name="insertedrowdate" type="timestamp"/>
        </createTable>

        <createTable tableName="algorithmrun" remarks="run of algorithm for given schedule that contains instance of algorithm, storage and downloaded view" >
            <column name="algorithmscheduleid" type="bigint"/>
            <column name="executorinstanceid" type="bigint"/>
            <column name="executorstorageid" type="varchar(4000)"/>
            <column name="algorithmrunid" type="varchar(4000)"/>
            <column name="sourcedownloadid" type="bigint"/>
            <column name="insertedrowdate" type="timestamp"/>
            <column name="rundate" type="timestamp"/>
            <column name="isrunning" type="int" />
            <column name="isfinished" type="int"/>
        </createTable>

        <createTable tableName="algorithmoutputtype" remarks="dictionary - type of output" >
            <column name="algorithmoutputtypeid" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="algorithmoutputtypename" type="varchar(4000)"/>
        </createTable>

        <createTable tableName="algorithmoutput" remarks="schedule of run algorithm for given instance and parameters on given executor, to be fixed - connect with storage for executor" >
            <column name="algorithmrunid" type="bigint"/>
            <column name="algorithmoutputid" type="bigint"/>
            <column name="algorithmoutputtypeid" type="bigint"/>
            <column name="executorstorageviewid" type="bigint"/>
            <column name="outputpath" type="varchar(4000)"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="executorinstance" baseColumnNames="executortypeid" referencedTableName="executortype" referencedColumnNames="executortypeid"  constraintName="fk_ei_executortype"  />
        <addForeignKeyConstraint baseTableName="executorinstance" baseColumnNames="executorhostid" referencedTableName="executorhost" referencedColumnNames="executorhostid"  constraintName="fk_ei_executorhost"  />
        <addForeignKeyConstraint baseTableName="executorstorage" baseColumnNames="executorhostid" referencedTableName="executorhost" referencedColumnNames="executorhostid"  constraintName="fk_es_"  />
        <addForeignKeyConstraint baseTableName="executorstorage" baseColumnNames="executorstoragetypeid" referencedTableName="executorstoragetype" referencedColumnNames="executorstoragetypeid"  constraintName="fk_es_executorstoragetype"  />
        <addForeignKeyConstraint baseTableName="executorstorageview" baseColumnNames="executorstorageid" referencedTableName="executorstorage" referencedColumnNames="executorstorageid"  constraintName="fk_esv_executorstorage"  />
        <addForeignKeyConstraint baseTableName="sourceinstance" baseColumnNames="sourcetypeid" referencedTableName="sourcetype" referencedColumnNames="sourcetypeid"  constraintName="fk_si_sourcetype"  />
        <addForeignKeyConstraint baseTableName="sourcetypeparam" baseColumnNames="sourcetypeid" referencedTableName="sourcetype" referencedColumnNames="sourcetypeid"  constraintName="fk_stp_sourcetype"  />
        <addForeignKeyConstraint baseTableName="sourcetypeparam" baseColumnNames="sourceparamid" referencedTableName="sourceparam" referencedColumnNames="sourceparamid"  constraintName="fk_stp_sourceparam"  />
        <addForeignKeyConstraint baseTableName="sourceparamvalue" baseColumnNames="sourceinstanceid" referencedTableName="sourceinstance" referencedColumnNames="sourceinstanceid"  constraintName="fk_spv_sourceinstance"  />
        <addForeignKeyConstraint baseTableName="sourceparamvalue" baseColumnNames="sourceparamid" referencedTableName="sourceparam" referencedColumnNames="sourceparamid"  constraintName="fk_spv_sourceparam"  />
        <addForeignKeyConstraint baseTableName="sourceview" baseColumnNames="sourceinstanceid" referencedTableName="sourceinstance" referencedColumnNames="sourceinstanceid"  constraintName="fk_sv_sourceinstance"  />
        <addForeignKeyConstraint baseTableName="sourceview" baseColumnNames="sourceviewtypeid" referencedTableName="sourceviewtype" referencedColumnNames="sourceviewtypeid"  constraintName="fk_sv_sourceviewtype"  />
        <addForeignKeyConstraint baseTableName="sourceviewcolumn" baseColumnNames="sourceviewid" referencedTableName="sourceview" referencedColumnNames="sourceviewid"  constraintName="fk_svc_sourceview"  />
        <addForeignKeyConstraint baseTableName="sourceschedule" baseColumnNames="sourceviewid" referencedTableName="sourceview" referencedColumnNames="sourceviewid"  constraintName="fk_svc_sourceview"  />
        <addForeignKeyConstraint baseTableName="sourceschedule" baseColumnNames="executorstorageid" referencedTableName="executorstorage" referencedColumnNames="executorstorageid"  constraintName="fk_svc_executorstorage"  />
        <addForeignKeyConstraint baseTableName="sourcedownload" baseColumnNames="sourcescheduleid" referencedTableName="sourceschedule" referencedColumnNames="sourcescheduleid"  constraintName="fk_sd_sourceschedule"  />
        <addForeignKeyConstraint baseTableName="algorithmtypeversion" baseColumnNames="algorithmtypeid" referencedTableName="algorithmtype" referencedColumnNames="algorithmtypeid"  constraintName="fk_atv_algorithmtype"  />
        <addForeignKeyConstraint baseTableName="algorithmimplementation" baseColumnNames="algorithmtypeid" referencedTableName="algorithmtype" referencedColumnNames="algorithmtypeid"  constraintName="fk_ai_algorithmtype"  />
        <addForeignKeyConstraint baseTableName="algorithmimplementation" baseColumnNames="algorithmtypeversionid" referencedTableName="algorithmtypeversion" referencedColumnNames="algorithmtypeversionid"  constraintName="fk_ai_algorithmtypeversion"  />
        <addForeignKeyConstraint baseTableName="algorithmparamtype" baseColumnNames="algorithmparamid" referencedTableName="algorithmparam" referencedColumnNames="algorithmparamid"  constraintName="fk_apt_algorithmparam"  />
        <addForeignKeyConstraint baseTableName="algorithmparamtype" baseColumnNames="algorithmtypeid" referencedTableName="algorithmtype" referencedColumnNames="algorithmtypeid"  constraintName="fk_apt_algorithmtype"  />
        <addForeignKeyConstraint baseTableName="executorstorageview" baseColumnNames="sourcedownloadid" referencedTableName="sourcedownload" referencedColumnNames="sourcedownloadid"  constraintName="fk_esv_sourcedownload"  />

    </changeSet>

</databaseChangeLog>
